echo "üîç Running pre-commit checks..."

# 1. Lint and format staged files
echo "üìù Linting and formatting staged files..."
pnpm lint-staged

# 2. Type checking
echo "üîç Type checking..."
pnpm exec vue-tsc --noEmit

# 3. Run tests
echo "üß™ Running tests..."
pnpm test

# 4. Check for debugger statements
echo "üêõ Checking for debugger statements..."
DEBUGGER_FILES=$(git diff --cached --name-only | grep -E '\.(ts|tsx|vue|js)$' | xargs grep -l "debugger" 2>/dev/null || true)
if [ -n "$DEBUGGER_FILES" ]; then
  echo "‚ùå Error: Found 'debugger' statement in staged files:"
  echo "$DEBUGGER_FILES"
  exit 1
fi

# 5. Check for .only in test files
echo "üß™ Checking for .only in test files..."
ONLY_FILES=$(git diff --cached --name-only | grep -E '\.(spec|test)\.(ts|tsx|js)$' | xargs grep -l -E "(it\.only|describe\.only|test\.only)" 2>/dev/null || true)
if [ -n "$ONLY_FILES" ]; then
  echo "‚ùå Error: Found '.only' in test files:"
  echo "$ONLY_FILES"
  exit 1
fi

echo "‚úÖ All pre-commit checks passed!"
